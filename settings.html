<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prios â€¢ Settings</title>
  <link rel="stylesheet" href="theme.css" />
  <style>
    .container { max-width: 900px; margin: 2rem auto; padding: 0 1rem; }
    .section { margin-bottom: 1.25rem; padding: 1rem; border: 1px solid var(--border-color); border-radius: .75rem; background: var(--bg-secondary); }
    .section h2 { margin-bottom: .75rem; }
  .row { display: grid; grid-template-columns: 1fr 1fr; gap: .75rem; }
  .mt-2 { margin-top: .5rem; }
  .grid-4 { display:grid; grid-template-columns: repeat(4,1fr); gap:.5rem; }
    .row label { display:block; font-weight:600; color: var(--text-secondary); margin-bottom:.25rem; }
    .actions { display:flex; gap:.5rem; justify-content: flex-end; margin-top: 1rem; }
  </style>
</head>
<body>
  <div class="header-nav">
    <div class="brand">Prios</div>
    <div class="links">
      <a href="index.html">Home</a>
      <a href="dashboard.html">Dashboard</a>
      <a href="todo-list.html">To-Do</a>
      <a href="task-planner-enhanced.html">Planner</a>
      <a href="productivity-parallel-coords.html">Analytics</a>
      <a href="reflection.html">Reflection</a>
      <a href="settings.html" class="active">Settings</a>
    </div>
  </div>

  <main class="container">
    <h1>Settings</h1>

    <form id="settingsForm" class="grid gap-4">
      <div class="section">
        <h2>Analytics Defaults</h2>
        <div class="row">
          <div>
            <label for="optimizer">Default Optimizer</label>
            <select id="optimizer">
              <option value="adam">Adam</option>
              <option value="pso">PSO</option>
              <option value="bayesian">Bayesian</option>
            </select>
          </div>
          <div>
            <label for="anomaly">Default Anomaly Method</label>
            <select id="anomaly">
              <option value="cusum">CUSUM/EWMA</option>
              <option value="isolation">IQR Isolation</option>
              <option value="ensemble">Ensemble</option>
            </select>
          </div>
        </div>
  <div class="row mt-2">
          <div>
            <label>EDQG Weights (sum = 1.0)</label>
            <div class="grid-4">
              <input id="wEffort" type="number" step="0.01" min="0" max="1" value="0.25" placeholder="Effort" />
              <input id="wDuration" type="number" step="0.01" min="0" max="1" value="0.25" placeholder="Duration" />
              <input id="wQuality" type="number" step="0.01" min="0" max="1" value="0.25" placeholder="Quality" />
              <input id="wGoal" type="number" step="0.01" min="0" max="1" value="0.25" placeholder="Goal" />
            </div>
          </div>
          <div>
            <label for="nlpEnabled">NLP Journal Parsing</label>
            <select id="nlpEnabled">
              <option value="on">Enabled</option>
              <option value="off">Disabled</option>
            </select>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>Planner Defaults</h2>
        <div class="row">
          <div>
            <label for="hourStart">Start Hour</label>
            <select id="hourStart">
              <option value="6">6 AM</option>
              <option value="7">7 AM</option>
              <option value="8" selected>8 AM</option>
              <option value="9">9 AM</option>
              <option value="10">10 AM</option>
            </select>
          </div>
          <div>
            <label for="hourEnd">End Hour</label>
            <select id="hourEnd">
              <option value="17">5 PM</option>
              <option value="18">6 PM</option>
              <option value="19">7 PM</option>
              <option value="20" selected>8 PM</option>
              <option value="21">9 PM</option>
            </select>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>Daily Rhythm</h2>
        <div class="row">
          <div>
            <label for="wakeTime">Ideal Wake Time</label>
            <input id="wakeTime" type="time" value="07:00" />
          </div>
          <div>
            <label for="bedTime">Ideal Bedtime</label>
            <input id="bedTime" type="time" value="22:30" />
          </div>
        </div>
      </div>

      <div class="actions">
        <button type="button" class="btn btn-secondary" id="resetBtn">Reset</button>
        <button type="submit" class="btn">Save Settings</button>
      </div>
    </form>
  </main>

  <script>
    const KEY = 'appSettings';
    function readSettings(){
      try{ return JSON.parse(localStorage.getItem(KEY)) || {}; }catch{ return {}; }
    }
    function writeSettings(obj){ localStorage.setItem(KEY, JSON.stringify(obj)); }
    function loadForm(){
      const s = readSettings();
      if (s.optimizer) document.getElementById('optimizer').value = s.optimizer;
      if (s.anomaly) document.getElementById('anomaly').value = s.anomaly;
      if (s.nlpEnabled) document.getElementById('nlpEnabled').value = s.nlpEnabled;
      if (s.weights){
        document.getElementById('wEffort').value = s.weights.e ?? 0.25;
        document.getElementById('wDuration').value = s.weights.d ?? 0.25;
        document.getElementById('wQuality').value = s.weights.q ?? 0.25;
        document.getElementById('wGoal').value = s.weights.g ?? 0.25;
      }
      if (s.planner){
        document.getElementById('hourStart').value = s.planner.start ?? 8;
        document.getElementById('hourEnd').value = s.planner.end ?? 20;
      }
      if (s.sleep){
        if (s.sleep.wake) document.getElementById('wakeTime').value = s.sleep.wake;
        if (s.sleep.bed) document.getElementById('bedTime').value = s.sleep.bed;
      }
    }
    function saveForm(e){
      e.preventDefault();
      const w = {
        e: parseFloat(document.getElementById('wEffort').value || '0.25'),
        d: parseFloat(document.getElementById('wDuration').value || '0.25'),
        q: parseFloat(document.getElementById('wQuality').value || '0.25'),
        g: parseFloat(document.getElementById('wGoal').value || '0.25')
      };
      const sum = (w.e + w.d + w.q + w.g) || 1;
      // Normalize weights to sum=1
      Object.keys(w).forEach(k=> w[k] = parseFloat((w[k]/sum).toFixed(2)));
      const s = {
        optimizer: document.getElementById('optimizer').value,
        anomaly: document.getElementById('anomaly').value,
        nlpEnabled: document.getElementById('nlpEnabled').value,
        weights: w,
        planner: {
          start: parseInt(document.getElementById('hourStart').value),
          end: parseInt(document.getElementById('hourEnd').value)
        },
        sleep: {
          wake: document.getElementById('wakeTime').value || '07:00',
          bed: document.getElementById('bedTime').value || '22:30'
        }
      };
      writeSettings(s);
      alert('Settings saved');
    }
    function reset(){ localStorage.removeItem(KEY); loadForm(); }
    document.getElementById('settingsForm').addEventListener('submit', saveForm);
    document.getElementById('resetBtn').addEventListener('click', reset);
    document.addEventListener('DOMContentLoaded', loadForm);
  </script>
</body>
</html>
